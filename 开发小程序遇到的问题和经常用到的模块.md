## 一、在云开发平台添加数据表时怎么给表添加表注释
>这个还没有开发出来


## 二、小程序上传图片功能代码

```javascript
var a = '123';

```

## 三、小程序连接云控制台中的数据库并且操作数据库数据

>### 表单页面
```xhtml

 
```



>### 页面标题
```js
{
  "navigationBarTitleText": "添加分类",
  "navigationBarBackgroundColor": "#267dcc"
}

```


>### 列表页面
```html
<view class="my-container">  
  <view class="box" wx:if="{{boxHidden}}">
    <view class="header">
      <view class="headerTop">
        <image class="touxiang" src="/images/myImages/hptouxiang.jpg" mode="aspectFit"></image>
        <view class="info">
          <p class="tele">{{modal.username}}</p>
          <p class="intro">
            <b class="puka">普卡</b>
            <b class="vip">VIP</b>
          </p>
        </view>
      </view>
      <view class="headerBottom">
        <image src="/images/myImages/vip.png" mode="aspectFit"></image>
        <image class="gray" src="/images/myImages/vip2.png" mode="aspectFit"></image>
        <image class="gray" src="/images/myImages/vip3.png" mode="aspectFit"></image>
        <image class="gray" src="/images/myImages/vip4.png" mode="aspectFit"></image>
      </view>
    </view>
    <view class="jifen">
      <ul>
        <li class="nowJiFen">
          <text class="num">300</text>
          <b>积分</b>
        </li>
        <li class="youhuijuan">
          <text class="num">0</text>
          <b>优惠券</b>
        </li>
        <li class="guanzhu">
          <text>关注微信</text>
        </li>
        <li class="youhuijuan">
          <text class="num">+50</text>
          <b>签到送积分</b>
        </li>
      </ul>
    </view>
    <view class="jianju"></view>
    <view class="person">
      <ul>
        <li wx:for="{{imgBox}}" wx:for-item="item">
          <span><image src="{{item.icon}}"></image></span>
          <b>{{item.info}}</b>
          <a><image src="/images/myImages/you.png"></image></a>
        </li>
      </ul>
    </view>
  </view>
</view>

```

```javascript
Page({
  data: {
    modalHidden:false,
    boxHidden:false,
    modal:{
      "username":"",
      "password":""
    },
    nameCheck:false,
    imgBox:[
      {
        "icon":"/images/myImages/l-dingdan.png",
        "info":"我的订单"
      },
      {
        "icon":"/images/myImages/l-shoucang.png",
        "info":"我的收藏"
      },
      {
        "icon":"/images/myImages/l-address.png",
        "info":"收货地址管理"
      },
      {
        "icon":"/images/myImages/l-jifen.png",
        "info":"积分商城"
      },
      {
        "icon":"/images/myImages/l-help.png",
        "info":"帮助中心"
      },
      {
        "icon":"/images/myImages/l-kefu.png",
        "info":"联系客服"
      },
      {
        "icon":"/images/myImages/l-about.png",
        "info":"关于我们"
      }
    ]
  },
  onLoad: function () {

  },
  onShow: function () {
    if(wx.getStorageSync("username")==""){
      this.setData({
        modalHidden:false,
        boxHidden:false
      })
      console.log("no");
    }else{
      var getUsername=wx.getStorageSync("username");
      var getPassword=wx.getStorageSync("password");
      this.setData({
        modalHidden:true,
        boxHidden:true,
        'modal.username': getUsername,
        'modal.password': getPassword
      })
      console.log("has");
    }
  },
  signConfirm:function(){
    if(this.data.nameCheck){
      wx.setStorageSync('username', this.data.modal.username);
      wx.setStorageSync('password', this.data.modal.password);
      this.setData({
        modalHidden:true,
        boxHidden:true
      })
    }
  },
  saveUsername:function(event){
    if(event.detail.value!=""){
      this.setData({
        'modal.username': event.detail.value,
        nameCheck:true
      });
    }
  },
  savePassword:function(event){
    this.setData({
      'modal.password': event.detail.value
    });
  },
  exit:function(){
    wx.setStorageSync("username","");
    wx.setStorageSync("password","");
    this.setData({
      modalHidden:false,
      boxHidden:false
    })
  }
});

```

```css
.my-container .login label {
  display: flex;
  flex-direction: row;
  padding-bottom: 20rpx; }
  .my-container .login label view {
    width: 120rpx;
    text-align: right; }
  .my-container .login label input {
    flex: 1;
    border-bottom: 1px solid #000; }

.my-container .header {
  width: 100%;
  background-color: #66cbff; }

.my-container .headerTop {
  display: flex; }

.my-container .headerTop .touxiang {
  width: 80px;
  height: 80px;
  border-radius: 40px;
  margin: 20px 0 0 25%; }

.my-container .info {
  flex: 1;
  padding-top: 36px;
  padding-left: 20px;
  display: flex;
  flex-direction: column; }

.my-container .tele {
  flex: 1;
  color: #fff;
  font-size: 14px; }

.my-container .intro {
  flex: 1; }

.my-container .intro .puka {
  background-color: #4069ff;
  padding: 2px 6px;
  font-size: 10px;
  color: #fff;
  border-top-left-radius: 10px;
  border-bottom-left-radius: 10px; }

.my-container .intro .vip {
  padding: 2px 6px;
  background-color: #fff;
  font-size: 12px;
  color: #f5b32b;
  border-top-right-radius: 10px;
  border-bottom-right-radius: 10px; }

.my-container .headerBottom {
  width: 60%;
  height: 26px;
  margin-left: 25%;
  padding: 5px 0 10px;
  display: flex;
  align-items: center;
  justify-content: center; }
  .my-container .headerBottom image {
    height: 26px;
    flex: 1; }
  .my-container .headerBottom .gray {
    -webkit-filter: grayscale(1);
    filter: gray;
    filter: grayscale(1); }

.my-container .jifen {
  width: 100%;
  height: 60px; }
  .my-container .jifen ul {
    width: 100%;
    display: flex;
    justify-content: space-around;
    padding: 10px 0; }
    .my-container .jifen ul li {
      flex: 1;
      border-left: 1px solid #C6C7C9;
      width: 25%;
      height: 34px;
      text-align: center; }
    .my-container .jifen ul .nowJiFen {
      border: none; }
      .my-container .jifen ul .nowJiFen .num {
        color: #e30013;
        font-size: 14px;
        display: block;
        font-weight: bold; }
      .my-container .jifen ul .nowJiFen b {
        font-size: 12px;
        color: #595758; }
    .my-container .jifen ul .youhuijuan .num {
      color: #e30013;
      font-size: 14px;
      display: block;
      font-weight: bold; }
    .my-container .jifen ul .youhuijuan b {
      font-size: 12px;
      color: #595758; }
    .my-container .jifen ul .guanzhu text {
      padding: 3px;
      font-size: 12px;
      color: #fff;
      background-color: #4b9536;
      border-radius: 2px; }

.my-container .jianju {
  background-color: #C6C7C9;
  height: 12px; }

.my-container .person ul {
  width: 100%; }
  .my-container .person ul li {
    height: 40px;
    width: 100%;
    border-bottom: 1px solid #C6C7C9;
    display: flex; }
    .my-container .person ul li span {
      padding: 7px; }
      .my-container .person ul li span image {
        width: 26px;
        height: 26px; }
    .my-container .person ul li b {
      padding-left: 30px;
      font-size: 12px;
      line-height: 40px;
      color: #595758; }
    .my-container .person ul li a {
      flex: 1;
      text-align: right; }
      .my-container .person ul li a image {
        width: 8px;
        height: 16px;
        margin-top: 12px;
        margin-right: 36px; }

.my-container .tuichu {
  width: 100%;
  padding-top: 30rpx;
  padding-left: 20%;
  box-sizing: border-box; }
  .my-container .tuichu text {
    background-color: #65a51e;
    display: block;
    width: 60%;
    height: 80rpx;
    line-height: 80rpx;
    border-radius: 10rpx;
    text-align: center;
    color: #fff;
    font-size: 14px; }


```

```js
{
  "navigationBarTitleText": "管理中心",
  "navigationBarBackgroundColor": "#0dc441"
}


```

### 查看数据

```javascript



```

### 添加数据

>在开始使用数据库 API 进行增删改查操作之前，需要先获取数据库的引用。以下调用获取默认环境的数据库的引用

```js
wx.cloud.init()
const db = wx.cloud.database()

```
- **插入数据**
>可以通过在集合对象上调用 add 方法往集合中插入一条记录。还是用待办事项清单的例子，比如我们想新增一个待办事项

```html
<form bindsubmit="formSubmit">
    <view class="main">
        <view class="form-content">
            <view class="form-item">
                <view class="left">分类名称</view>
                <input class="right-input" name="typename"  placeholder="请输入分类名称" />
            </view>

            <view class="form-item">
                <view class="left">上级分类</view>
                <view class='select_box'>
                    <view class='select' catchtap='selectTap'>
                        <text class='select_text'>{{selectData[index]}}</text>
                        <image class='select_img {{show&&"select_img_rotate"}}' src='/image/gobottom.png'></image>   
                    </view>
                    <view class='option_box' style='height:{{show?(selectData.length>5?300:selectData.length*60):0}}rpx;'>
                    <text class='option' style='{{index==selectData.length-1&&"border:0;"}}' wx:for='{{selectData}}' wx:key='this' data-index='{{index}}' catchtap='optionTap'>{{item}}</text>
                    </view>
                </view>
            </view>
            <view class="form-item">
                <view class="left">分类级别</view>
                <input class="right-input" name="typenum" placeholder="请输入数字" />
            </view>
                
        </view>
    </view>
    <view class="bottom">
        <button class="save-btn" form-type="submit">保存</button>
    </view>
</form>

```

```javascript
Page({
  onShareAppMessage() {
    return {
      title: 'form',
      path: 'page/component/pages/form/form'
    }
  },

  data: {
    pickerHidden: true,
    chosen: '',
    show:false,//控制下拉列表的显示隐藏，false隐藏、true显示
    selectData:['1','2','3','4','5','6'],//下拉列表的数据
    index:0//选择的下拉列表下标
  },
  selectTap(){
    this.setData({
     show: !this.data.show
    });
    },
    // 点击下拉列表
    optionTap(e){
      let Index=e.currentTarget.dataset.index;//获取点击的下拉列表的下标
      this.setData({
      index:Index,
      show:!this.data.show
      });
    },
  pickerConfirm(e) {
    this.setData({
      pickerHidden: true
    })
    this.setData({
      chosen: e.detail.value
    })
  },

  pickerCancel() {
    this.setData({
      pickerHidden: true
    })
  },

  pickerShow() {
    this.setData({
      pickerHidden: false
    })
  },
  //form发生了submit事件
  formSubmit(e) {
    console.log('form发生了submit事件，携带数据为：', e.detail.value)
    let data = e.detail.value
    wx.cloud.init()
    const db = wx.cloud.database()
    db.collection('shop_type').add({
      // data 字段表示需新增的 JSON 数据
      data: {
        typename: data.typename,
        typenum: data.typenum,
        isTouchMove: false //这个字段是为了在左滑列表中的单个时需要判断的地方
      },
      success: function(res) {
        // res 是一个对象，其中有 _id 字段标记刚创建的记录的 id
        console.log(res)
        wx.navigateTo({
          // 添加完后跳转到商品列表页
          url: '../shoptype'
        })  
      }
    })



  },

  formReset(e) {
    console.log('form发生了reset事件，携带数据为：', e.detail.value)
    this.setData({
      chosen: ''
    })
  }
})


```

### 删除数据

```javascript



```


## 问题：
### 一、列表中的页面跳转遇到的问题
```html
<a catchtap="goHouseDetail" data-pageath="{{item.url}}">
	<image src="/images/myImages/you.png"></image>
</a>

```

```javascript
goHouseDetail:function(e){
      var pageath = e.currentTarget.dataset.pageath;
      console.log(pageath);
      wx.navigateTo({
        url: pageath
      })    
    }

```
>#### 这里遇到一个问题
>pageath这里的这个单词最好不要有大写的字母，不然会报错

>#### *errMsg: "navigateTo:fail parameter error: parameter.url should be String instead of Undefined;"*


### 二、this.setData不起作用
>原因：this的使用套了两层方法，已经不再指向page

>方法:提前声明一个变量指向page
```js
onLoad: function (options) {
    var thisPage = this;
    wx.cloud.init()
    const db = wx.cloud.database()
    db.collection('shop_type').get({
      success: function(res) {
        // res.data 是包含以上定义的两条记录的数组
        thisPage.setData({
          dataList:res.data
        });
        console.log(res.data)
      }
    })
}


```



### 三、微信小程序之列表左滑功能无法左滑
>***TypeError: Cannot read property '_touchmove' of undefined***

#### 原因：

>***app.js中没有写：***
```js
touch: new touch()

```




>***使用app函数的地方没有写：***

```js
const App = getApp() //如果需要使用app.js的话需要在对应的js文件中定义一下app
```

>***whtml页面的列表标签中没有写属性：***

```js
data-id="{{item._id}}"
```

>***滑动事件处理中也有问题：***

```js
//滑动事件处理
touchmove: function (e) {
	//将修改过的list setData '_id' 就是返回的数据列表中的字段，不要写错了
	let data = App.touch._touchmove(e, this.data.dataList,'_id')
	this.setData({
	  dataList: data
	})
},
 
```

>***还缺少的东西：***

```txt
需要在往数据库添加数据的时候把 isTouchMove: false 字段添加一下值
```